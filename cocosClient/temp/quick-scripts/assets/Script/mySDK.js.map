{"version":3,"sources":["mySDK.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"../../../../assets/Script","sourcesContent":["\n  //获取微信界面大小\n  let width = 0;\n  let height = 0;\nexport function login(lable: cc.Label) {\n  wx.login({\n    success(res) {\n      lable.string = `${res.code}`;\n      if (res.code) {\n        console.log(\"登录成功！\" );\n      } else {\n        console.log(\"登录失败！\" + res.errMsg);\n      }\n    }\n  });\n}\n\n\n//获取授权\nexport function getSetting(lable: cc.Node) {\n  try {\n     //获取微信界面大小\n  let sysInfo = wx.getSystemInfoSync();\n   width = sysInfo.screenWidth;\n   height = sysInfo.screenHeight;\n  } catch (e) {\n    console.log(\"获取系统参数失败\")\n  }\n\n  wx.getSetting({\n    success(res) {\n      console.log(res.authSetting)\n      if (res.authSetting['scope.userInfo']) {\n        console.log(\"userInfo 已经授权\");\n\n        //获取用户信息\n        getUserInfo(lable);\n      }else{\n        console.log(\"userInfo 未授权\");\n        //请求用户信息\n\n      if (res.authSetting['scope.userInfo'] === false){\n        console.log(\"用户 userInfo 已经拒绝\");\n            // 用户已拒绝授权，再调用相关 API 或者 wx.authorize 会失败，需要引导用户到设置页面打开授权开关\n            // wx.authorize({\n            //   scope: 'scope.userInfo',\n            //   success() {\n            //     console.log(\"用户 成功 授权\");\n            //     getUserInfo(lable);\n            //   },\n            //   fail(){\n            //     console.log(\"用户 拒绝 授权\");\n            //   }\n            // });\n            \n            //通过button可以实现继续授权;\n            createUserInfoButton(lable);\n            //  wx.openSetting({\n            //   success(res) {\n            //     console.log(res.authSetting)\n            //   }\n          } else{\n            // console.log(\"用户 userInfo 首次操作\");\n            // console.log(res.authSetting)\n            // createUserInfoButton(lable);\n          wx.authorize({\n            scope: 'scope.userInfo',\n            success() {\n              console.log(\"用户 成功 授权\");\n              getUserInfo(lable);\n            },\n            fail(){\n              console.log(\"用户 拒绝 授权\");\n            }\n          })\n        }\n\n      }\n    }\n  })\n\n}\n\n\nexport function getUserInfo(lable: cc.Node) {\n  wx.getUserInfo({\n    success(res) {\n      console.log(\"getUserInfo success \");\n      console.log(\"res is \",res);\n      console.log(\"在微信登录里面昵称是 :\"+res.userInfo.nickName);\n      console.log(\"用户头像信息 :\"+res.userInfo.avatarUrl);\n\n      //必须加上?aa=aa.jpg\n      cc.loader.load(res.userInfo.avatarUrl+\"?aa=aa.jpg\", function (err, texture) {\n        // Use texture to create sprite frame\n        const sf = new cc.SpriteFrame();\n        sf.setTexture(texture)\n        lable.getComponent(cc.Sprite).spriteFrame = sf;\n    });\n    },\n    fail:function(){\n      console.log(\"getUserInfo fail \");\n    },\n    complete:function(){\n      console.log(\"getUserInfo complete \");\n    },\n  });\n}\n\nexport function createUserInfoButton(lable:cc.Node){\n  console.log(\"width\",width);\n  console.log(\"height\",height);\n  const button = wx.createUserInfoButton({\n    type: 'text',\n    text: '获取用户信息',\n    style: {\n      left: width/2 -100,\n      top: height/2 -20,\n      width: 200,\n      height: 40,\n      lineHeight: 40,\n      backgroundColor: '#ff0000',\n      color: '#ffffff',\n      textAlign: 'center',\n      fontSize: 16,\n      borderRadius: 4,\n    },\n  });\n\n  button.onTap((res) => {\n    if (res.userInfo) {\n      console.log(\"用户授权:\", res);\n      //此时可进行登录操作\n\n      //获取用户信息\n      getUserInfo(lable);\n      button.destroy();\n  }else {\n      console.log(\"用户拒绝授权:\", res);\n      button.destroy();\n  }\n  })\n}\n\n\n\n\n// export function authorize(lable: cc.Node) {\n//   wx.authorize({\n//     success(res) {\n//       console.log(res.authSetting)\n//       if (res.authSetting['scope.userInfo']) {\n//         console.log(\"userInfo 已经授权\")\n//         getUserInfo(lable)\n//       }else{\n//         console.log(\"userInfo 未授权\")\n//       }\n//     }\n//   })\n// }\n\n"]}